{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout - Bridge Online School{% endblock %}

{% block content %}
<!-- CSRF Token for AJAX requests -->
{% csrf_token %}

<script>
// Django configuration for checkout
window.CHECKOUT_CONFIG = {
    createCheckoutUrl: "{% url 'shoppingCard:create_checkout' %}",
    checkoutSuccessUrl: "{% url 'shoppingCard:checkout_success' %}",
    userEmail: "{{ user.email|default:'' }}",
    userName: "{{ user.get_full_name|default:user.username }}"
};
</script>

<section class="checkout-form section light-background" style="padding-top: 120px;">
  <div class="container" data-aos="fade-up">
    
    <!-- Back Button -->
    <div class="row mb-4">
      <div class="col-12">
        <a href="{% url 'shoppingCard:cart' %}" class="btn rounded-pill" style="background-color: var(--accent-color); color: var(--contrast-color); border: none;">
          <i class="bi bi-arrow-left me-2"></i>Back to Cart
        </a>
      </div>
    </div>

    <!-- Checkout Header -->
    <div class="row mb-5">
      <div class="col-12 text-center">
        <h1 class="display-5 fw-bold mb-3" style="color: var(--heading-color);">
          <i class="bi bi-credit-card me-3"></i>Checkout
        </h1>
        <p class="lead text-muted">Complete your purchase securely</p>
      </div>
    </div>

    <div class="row">
      <!-- Checkout Form -->
      <div class="col-lg-8">
        <form id="checkoutForm" novalidate>
          <!-- Personal Details Section -->
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0" style="color: var(--heading-color);">
                <i class="bi bi-person me-2"></i>Personal Details
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="firstName" class="form-label">First Name *</label>
                  <input type="text" class="form-control" id="firstName" name="firstName" required>
                  <div class="invalid-feedback">Please provide your first name.</div>
                </div>
                <div class="col-md-6">
                  <label for="lastName" class="form-label">Last Name *</label>
                  <input type="text" class="form-control" id="lastName" name="lastName" required>
                  <div class="invalid-feedback">Please provide your last name.</div>
                </div>
                <div class="col-12">
                  <label for="email" class="form-label">Email Address *</label>
                  <input type="email" class="form-control" id="email" name="email" required>
                  <div class="invalid-feedback">Please provide a valid email address.</div>
                </div>
                <div class="col-12">
                  <label for="phone" class="form-label">Phone Number</label>
                  <input type="tel" class="form-control" id="phone" name="phone" placeholder="+1 (555) 123-4567">
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Details Section -->
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0" style="color: var(--heading-color);">
                <i class="bi bi-credit-card me-2"></i>Payment Information
              </h5>
            </div>
            <div class="card-body">
              <!-- Payment Method Selection -->
              <div class="row mb-4">
                <div class="col-12">
                  <label class="form-label">Payment Method *</label>
                  <div class="row g-2">
                    <div class="col-md-4">
                      <div class="form-check payment-method-card">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="credit_card" checked>
                        <label class="form-check-label" for="creditCard">
                          <i class="bi bi-credit-card me-2"></i>Credit Card
                        </label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check payment-method-card payment-method-disabled">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="paypal" value="paypal" disabled>
                        <label class="form-check-label" for="paypal">
                          <i class="bi bi-paypal me-2"></i>PayPal <small class="text-muted">(available soon)</small>
                        </label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check payment-method-card payment-method-disabled">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="stripe" value="stripe" disabled>
                        <label class="form-check-label" for="stripe">
                          <i class="bi bi-stripe me-2"></i>Stripe <small class="text-muted">(available soon)</small>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Credit Card Details -->
              <div id="creditCardDetails">
                <div class="row g-3">
                  <div class="col-12">
                    <label for="cardNumber" class="form-label">Card Number *</label>
                    <input type="text" class="form-control" id="cardNumber" name="cardNumber" 
                           placeholder="1234 5678 9012 3456" maxlength="19" required>
                    <div class="invalid-feedback">Please provide a valid card number.</div>
                  </div>
                  <div class="col-md-6">
                    <label for="expiryDate" class="form-label">Expiry Date *</label>
                    <input type="text" class="form-control" id="expiryDate" name="expiryDate" 
                           placeholder="MM/YY" maxlength="5" required>
                    <div class="invalid-feedback">Please provide a valid expiry date.</div>
                  </div>
                  <div class="col-md-6">
                    <label for="cvv" class="form-label">CVV *</label>
                    <input type="text" class="form-control" id="cvv" name="cvv" 
                           placeholder="123" maxlength="4" required>
                    <div class="invalid-feedback">Please provide a valid CVV.</div>
                  </div>
                  <div class="col-12">
                    <label for="cardName" class="form-label">Name on Card *</label>
                    <input type="text" class="form-control" id="cardName" name="cardName" required>
                    <div class="invalid-feedback">Please provide the name on the card.</div>
                  </div>
                </div>
              </div>

              <!-- Alternative Payment Messages - removed as notifications not needed -->
            </div>
          </div>

          <!-- Billing Address Section -->
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0" style="color: var(--heading-color);">
                <i class="bi bi-geo-alt me-2"></i>Billing Address
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-12">
                  <label for="address" class="form-label">Street Address</label>
                  <input type="text" class="form-control" id="address" name="address" placeholder="123 Main Street">
                </div>
                <div class="col-md-6">
                  <label for="city" class="form-label">City</label>
                  <input type="text" class="form-control" id="city" name="city">
                </div>
                <div class="col-md-3">
                  <label for="state" class="form-label">State</label>
                  <input type="text" class="form-control" id="state" name="state">
                </div>
                <div class="col-md-3">
                  <label for="zipCode" class="form-label">ZIP Code</label>
                  <input type="text" class="form-control" id="zipCode" name="zipCode">
                </div>
                <div class="col-12">
                  <label for="country" class="form-label">Country</label>
                  <select class="form-select" id="country" name="country">
                    <option value="">Select Country</option>
                    <option value="US" selected>United States</option>
                    <option value="CA">Canada</option>
                    <option value="UK">United Kingdom</option>
                    <option value="AU">Australia</option>
                    <option value="DE">Germany</option>
                    <option value="FR">France</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Terms and Conditions -->
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-body">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
                <label class="form-check-label" for="terms">
                  I agree to the <a href="#" style="color: var(--accent-color);">Terms of Service</a> 
                  and <a href="#" style="color: var(--accent-color);">Privacy Policy</a> *
                </label>
                <div class="invalid-feedback">You must agree to the terms and conditions.</div>
              </div>
            </div>
          </div>

        </form>
      </div>

      <!-- Order Summary -->
      <div class="col-lg-4">
        <div class="card shadow-sm border-0 sticky-top" style="top: 100px;">
          <div class="card-header bg-light">
            <h5 class="mb-0" style="color: var(--heading-color);">Order Summary</h5>
          </div>
          <div class="card-body">
            <!-- Cart items will be populated by JavaScript -->
            <div id="orderSummary">
              <div class="text-center py-3">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </div>
            
            <hr>
            
            <div class="d-flex justify-content-between mb-3">
              <span>Total Lessons:</span>
              <span class="fw-bold" id="summaryTotalItems">0</span>
            </div>
            
            <div class="d-flex justify-content-between mb-4">
              <span class="h6">Total Amount:</span>
              <span class="h5" style="color: var(--accent-color);" id="summaryTotalPrice">$0.00</span>
            </div>
            
            <button type="submit" form="checkoutForm" class="btn w-100 rounded-pill mb-3" id="completeOrderBtn"
                    style="background-color: var(--accent-color); color: var(--contrast-color); border: none;">
              <i class="bi bi-lock me-2"></i>Complete Order
            </button>
            
            <div class="text-center">
              <small class="text-muted">
                <i class="bi bi-shield-check me-1"></i>
                Your payment information is secure and encrypted
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>
 
{% endblock %} 